@using AutoDokas.Data.Models
@using AutoDokas.Extensions
@using AutoDokas.Resources
@inherits ComponentBase

<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Transporto priemonės pirkimo-pardavimo sutartis</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --navy: #0f172a;
            --navy-light: #1e293b;
            --blue: #2563eb;
            --slate: #64748b;
            --slate-light: #94a3b8;
            --border: #e2e8f0;
            --surface: #f8fafc;
            --green: #22c55e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--navy-light);
            font-size: 13px;
            line-height: 1.6;
            padding: 0 10px;
        }

        /* ===== HEADER ===== */
        .contract-header {
            text-align: center;
            margin-bottom: 28px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--navy);
        }

        .contract-header h1 {
            font-size: 20px;
            font-weight: 800;
            color: var(--navy);
            letter-spacing: -0.02em;
            margin-bottom: 16px;
        }

        .contract-meta {
            display: flex;
            justify-content: center;
            gap: 32px;
            flex-wrap: wrap;
        }

        .contract-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--slate);
        }

        .contract-meta-item strong {
            color: var(--navy);
            font-weight: 600;
        }

        /* ===== SECTIONS ===== */
        .section {
            margin-bottom: 16px;
            background: #fff;
        }

        .section-head {
            padding: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-num {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 26px;
            height: 26px;
            background: var(--blue);
            color: #fff;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 700;
            flex-shrink: 0;
        }

        .section-head h2 {
            font-size: 14px;
            font-weight: 700;
            color: var(--navy);
            margin: 0;
            border: none;
            padding: 0;
        }

        .section-content {
            padding: 0;
        }

        .section-content p {
            font-size: 12px;
            color: var(--slate);
            margin-bottom: 12px;
        }

        /* ===== DATA TABLE ===== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table tr {
            border-bottom: 1px solid #f1f5f9;
        }

        .data-table tr:last-child {
            border-bottom: none;
        }

        .data-table th,
        .data-table td {
            padding: 8px 12px;
            text-align: left;
            vertical-align: top;
            border: none;
        }

        .data-table th {
            width: 40%;
            font-size: 12px;
            font-weight: 500;
            color: var(--navy);
            background: none;
        }

        .data-table td {
            font-size: 13px;
            color: var(--navy-light);
        }

        .data-table tr:nth-child(even) {
            background: var(--surface);
        }

        /* ===== COMPACT INFO GRID ===== */
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px 24px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .info-item.full-width {
            grid-column: 1 / -1;
        }

        .info-label {
            font-size: 10px;
            font-weight: 500;
            color: var(--slate);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .info-value {
            font-size: 13px;
            color: var(--navy);
            font-weight: 500;
        }

        /* ===== PARTIES SECTION ===== */
        .parties-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .party-box {
            padding: 0;
            background: #fff;
        }

        .party-title {
            font-size: 12px;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 10px;
            padding-bottom: 6px;
        }

        /* ===== VEHICLE STATUS ===== */
        .vehicle-status-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .status-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .status-label {
            font-size: 9px;
            font-weight: 500;
            color: var(--slate);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .defects-section {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .additional-info {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .additional-info p {
            margin: 4px 0 0 0;
        }

        /* ===== BADGES ===== */
        .badge-success {
            display: inline-block;
            background: #dcfce7;
            color: #15803d;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-danger {
            display: inline-block;
            background: #fef2f2;
            color: #991b1b;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-info {
            display: inline-block;
            background: #eff6ff;
            color: var(--blue);
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        /* ===== DEFECT LIST ===== */
        .defect-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .defect-list li {
            background: #fef2f2;
            color: #991b1b;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        /* ===== OBLIGATIONS ===== */
        .obligations-section {
            margin-bottom: 16px;
            background: #fff;
        }

        .obligations-section .section-head {
        }

        .obligations-content {
            padding: 0;
            font-size: 12px;
            color: var(--navy-light);
            line-height: 1.7;
        }

        .obligations-content ul {
            padding-left: 20px;
            margin: 0;
        }

        .obligations-content li {
            margin-bottom: 10px;
        }

        .obligations-content li:last-child {
            margin-bottom: 0;
        }

        /* ===== SIGNATURES ===== */
        .signatures {
            display: flex;
            justify-content: space-between;
            gap: 40px;
            margin-top: 8px;
        }

        .sig-block {
            flex: 1;
            text-align: center;
        }

        .sig-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 8px;
        }

        .sig-image {
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
        }

        .sig-image img {
            max-height: 120px;
            max-width: 280px;
        }

        .sig-line {
            border-top: 1px solid var(--navy);
            padding-top: 6px;
            font-size: 11px;
            color: var(--slate);
        }
    </style>
</head>

<body>
    <header class="contract-header">
        <h1>TRANSPORTO PRIEMONĖS PIRKIMO–PARDAVIMO SUTARTIS</h1>
        <div class="contract-meta">
            <div class="contract-meta-item">
                <strong>@Text.ContractCreationDate:</strong> @CreatedAtLocal.ToShortDateString() @CreatedAtLocal.ToShortTimeString()
            </div>
            <div class="contract-meta-item">
                <strong>@Text.Origin:</strong> @(Contract.Origin?.Name ?? "-")
            </div>
        </div>
    </header>

    <!-- SELLER & BUYER -->
    <div class="parties-container">
        <div class="party-box">
            <div class="party-title">Pardavėjas (transporto priemonės savininkas)</div>
            <div class="info-grid">
                <div class="info-item full-width">
                    <span class="info-label">@Text.Name</span>
                    <span class="info-value">@(Contract.SellerInfo?.Name ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Code</span>
                    <span class="info-value">@(Contract.SellerInfo?.Code ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Phone</span>
                    <span class="info-value">@(Contract.SellerInfo?.Phone ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Email</span>
                    <span class="info-value">@(Contract.SellerInfo?.Email ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Address</span>
                    <span class="info-value">@(Contract.SellerInfo?.Address ?? "-")</span>
                </div>
            </div>
        </div>

        <div class="party-box">
            <div class="party-title">Pirkėjas (transporto priemonės įgijėjas)</div>
            <div class="info-grid">
                <div class="info-item full-width">
                    <span class="info-label">@Text.Name</span>
                    <span class="info-value">@(Contract.BuyerInfo?.Name ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Code</span>
                    <span class="info-value">@(Contract.BuyerInfo?.Code ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Phone</span>
                    <span class="info-value">@(Contract.BuyerInfo?.Phone ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Email</span>
                    <span class="info-value">@(Contract.BuyerInfo?.Email ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Address</span>
                    <span class="info-value">@(Contract.BuyerInfo?.Address ?? "-")</span>
                </div>
            </div>
        </div>
    </div>

    <!-- VEHICLE -->
    <div class="section">
        <div class="section-head">
            <h2>@Text.VehicleInformation</h2>
        </div>
        <div class="section-content">
            <p style="margin-bottom: 12px;">Pardavėjas parduoda, o pirkėjas perka pardavėjui nuosavybės teise priklausančią transporto priemonę:</p>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">@Text.Sdk</span>
                    <span class="info-value">@(Contract.VehicleInfo?.Sdk ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Make</span>
                    <span class="info-value">@(Contract.VehicleInfo?.Make ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.RegistrationNumber</span>
                    <span class="info-value">@(Contract.VehicleInfo?.RegistrationNumber ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.RegistrationCertificate</span>
                    <span class="info-value">@(Contract.VehicleInfo?.RegistrationCertificate ?? "-")</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.Millage</span>
                    <span class="info-value">@(Contract.VehicleInfo?.Millage.ToString("N0") ?? "0") km</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.IdentificationNumber</span>
                    <span class="info-value">@(Contract.VehicleInfo?.IdentificationNumber ?? "-")</span>
                </div>
            </div>

            <div class="vehicle-status-grid">
                <div class="status-item">
                    <span class="status-label">@Text.IsInspected</span>
                    @if (Contract.VehicleInfo?.IsInspected ?? false)
                    {
                        <span class="badge-success">@Text.Valid</span>
                    }
                    else
                    {
                        <span class="badge-danger">@Text.Invalid</span>
                    }
                </div>
                <div class="status-item">
                    <span class="status-label">@Text.DamagedDuringOwnership</span>
                    @if (Contract.VehicleInfo?.DamagedDuringOwnership ?? false)
                    {
                        <span class="badge-danger">@Text.Yes</span>
                    }
                    else
                    {
                        <span class="badge-success">@Text.No</span>
                    }
                </div>
                <div class="status-item">
                    <span class="status-label">@Text.DamageIncidentsKnown</span>
                    @if (Contract.VehicleInfo?.DamageIncidentsKnown ?? false)
                    {
                        <span class="badge-danger">@Text.Yes</span>
                    }
                    else
                    {
                        <span class="badge-success">@Text.No</span>
                    }
                </div>
            </div>

            @if (Contract.VehicleInfo?.Defects != null && Contract.VehicleInfo.Defects.Any())
            {
                <div class="defects-section">
                    <span class="info-label">@Text.Defects</span>
                    <ul class="defect-list">
                        @foreach (var defect in Contract.VehicleInfo.Defects)
                        {
                            <li>@defect.GetDisplayName()</li>
                        }
                    </ul>
                </div>
            }

            @if (!string.IsNullOrWhiteSpace(Contract.VehicleInfo?.AdditionalInformation))
            {
                <div class="additional-info">
                    <span class="info-label">@Text.AdditionalInformation</span>
                    <p class="info-value">@Contract.VehicleInfo.AdditionalInformation</p>
                </div>
            }
        </div>
    </div>

    <!-- PAYMENT -->
    <div class="section">
        <div class="section-head">
            <h2>@Text.PaymentInformation</h2>
        </div>
        <div class="section-content">
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">@Text.Price</span>
                    <span class="info-value">@(Contract.PaymentInfo?.Price.ToString("N2") ?? "0.00") €</span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.PaymentMethod</span>
                    <span class="info-value">
                        @if (Contract.PaymentInfo?.PaymentMethod != null)
                        {
                            <span class="badge-info">@Contract.PaymentInfo.PaymentMethod.Value.GetDisplayName()</span>
                        }
                        else
                        {
                            <span>-</span>
                        }
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.PaymentMoment</span>
                    <span class="info-value">
                        @if (Contract.PaymentInfo?.PaymentAtContractFormation ?? false)
                        {
                            @Text.AtContractFormation
                        }
                        else if (Contract.PaymentInfo?.PaymentDate != null)
                        {
                            @Contract.PaymentInfo.PaymentDate.Value.ToString("yyyy-MM-dd")
                        }
                        else
                        {
                            <span>-</span>
                        }
                    </span>
                </div>
                <div class="info-item">
                    <span class="info-label">@Text.TransferInsurance</span>
                    <span class="info-value">
                        @if (Contract.PaymentInfo?.TransferInsurance ?? false)
                        {
                            <span class="badge-success">@Text.Yes</span>
                        }
                        else
                        {
                            <span class="badge-danger">@Text.No</span>
                        }
                    </span>
                </div>
            </div>
            @if (!string.IsNullOrWhiteSpace(Contract.PaymentInfo?.AdditionalInformation))
            {
                <div class="additional-info">
                    <span class="info-label">@Text.AdditionalInformation</span>
                    <p class="info-value">@Contract.PaymentInfo.AdditionalInformation</p>
                </div>
            }
        </div>
    </div>

    <!-- OBLIGATIONS & SIGNATURES -->
    <div class="obligations-section">
        <div class="section-head">
            <h2>Šalių įsipareigojimai ir parašai</h2>
        </div>
        <div class="obligations-content">
            <p>Pirkėjo ir Pardavėjo įsipareigojimai pasirašant šią Transporto priemonės pirkimo-pardavimo sutartį:</p>
            <ul>
                <li><strong>Pardavėjas</strong> patvirtina, kad parduodama transporto priemonė priklauso jam nuosavybės
                    teise, į parduodamą transporto priemonę tretieji asmenys jokių teisių ar pretenzijų neturi, transporto
                    priemonė neareštuota, ji nėra teisinio ginčo objektas, teisė disponuoti ja neatimta ir
                    neapribota. Perduodamos transporto priemonės identifikavimo numeris ir kiti duomenys atitinka jos
                    registracijos dokumente nurodytus duomenis.</li>
                <li>
                    <strong>Pirkėjas</strong> ir <strong>Pardavėjas</strong>, vadovaudamiesi Lietuvos Respublikos saugaus
                    eismo automobilių keliais įstatymo 20 straipsnio 1 dalimi, privalo REGITRAI deklaruoti duomenis apie
                    įgytą arba perleistą nuosavybės teisę į transporto priemonę, t. y. <strong>Pirkėjas</strong> – per 5
                    darbo dienas nuo nuosavybės teisės įgijimo dienos, o <strong>Pardavėjas</strong> – per 5 darbo dienas
                    nuo Pirkėjo duomenų apie įgytą nuosavybės teisę deklaravimo dienos.
                </li>
                <li>
                    <strong>Pardavėjas</strong> ir <strong>Pirkėjas</strong> patvirtina, kad jiems yra žinoma, jog Lietuvos
                    Respublikos kelių transporto priemonių registre registruojamos tik tos transporto priemonės, kurių
                    savininkas Lietuvos Respublikos saugaus eismo automobilių keliais įstatymo 20 straipsnyje nustatyta
                    tvarka Lietuvos Respublikos kelių transporto priemonių registro tvarkytojui (REGITRAI) yra deklaravęs
                    duomenis apie registruojamos transporto priemonės nuosavybės teisę.
                </li>
                <li>
                    <strong>Pirkėjas</strong> patvirtina, kad prieš sudarydamas šią sutartį jis įvertino transporto
                    priemonės ridą (odometro duomenis), taip pat transporto priemonės ir jos atskirų dalių būklę ir dėl jos
                    jokių pretenzijų <strong>Pardavėjui</strong> neturi.
                </li>
            </ul>

            <div class="signatures">
                <div class="sig-block">
                    <div class="sig-label">Pardavėjas</div>
                    <div class="sig-image">
                        @if (Contract.SellerInfo?.SignatureData != null)
                        {
                            <img src="data:image/png;base64,@Convert.ToBase64String(Contract.SellerInfo.SignatureData)"
                                alt="Pardavėjo parašas" />
                        }
                    </div>
                    <div class="sig-line">@(Contract.SellerInfo?.Name ?? "________________")</div>
                </div>

                <div class="sig-block">
                    <div class="sig-label">Pirkėjas</div>
                    <div class="sig-image">
                        @if (Contract.BuyerInfo?.SignatureData != null)
                        {
                            <img src="data:image/png;base64,@Convert.ToBase64String(Contract.BuyerInfo.SignatureData)"
                                alt="Pirkėjo parašas" />
                        }
                    </div>
                    <div class="sig-line">@(Contract.BuyerInfo?.Name ?? "________________")</div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>

@code {
    [Parameter]
    public VehicleContract Contract { get; set; } = default!;

    private DateTime CreatedAtLocal => Contract.CreatedAt.ToLithuanianTime();
}